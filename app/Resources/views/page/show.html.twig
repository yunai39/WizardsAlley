{% extends '::base.html.twig' %}

{% block body_style %} url('{{ asset(page.getPictureCouverture) }}'){% endblock %}


{% block title_banner %}
    <div class="imgSquare circle">
        <div class="imgSquareContainer circle">
            <img src="{{ asset(page.getPictureProfile()) }}" class="circle"/>
        </div>
    </div>
    <h1>
        {{ page.name }}
    </h1>
    {% if page.officialPage or page.redactorPage %}
        <h2>
            {% if page.officialPage %}
                {% trans %}wizard.page.label.official{% endtrans %}
            {% endif %}
            {% if page.redactorPage and page.redactorPage %}
                -
            {% endif %}
            {% if page.redactorPage %}
                {% trans %}wizard.page.label.redactor{% endtrans %}
            {% endif %}
        </h2>

        <h3>
            {% trans %}wizard.category.name{% endtrans %}:
            <a href="{{ path('wizardalley_page_category', {'category_id': page.category.id}) }}">{{ page.category.name }}</a>
        </h3>
    {% endif %}
{% endblock %}

{% block body -%}

    <div class="row">
        <!-- Si l'utilisateur est authorise a changer les publications -->
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-3">
                    <div class="panel panel-default">
                            <div class="panel-body">
                                {% if app.user %}

                                    {% if  app.user in editors or app.user.id == creator_id %}
                                        <div class="col-md-12">
                                            <a href="{{ path('page_gestion_show',{'id_page': page.id } ) }}"> <span
                                                        class="icon-large icon icon-book"></span>{% trans %}
                                                wizard.page.gestion.edit {% endtrans %}</a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                                <div class="col-md-12">
                                    {% if page.urlFacebook != null %}
                                        <a href="{{ page.urlFacebook }}"/><span class="icon-large icon-facebook"
                                                                                aria-hidden="true"></span> {{ page.urlFacebook }}</a>
                                    {% endif %}
                                </div>
                                <div class="col-md-12">
                                    <span class="icon-large icon  icon-heart"></span> {% trans %}
                                    wizard.page.followers {% endtrans %} {{ page.followers | length }}
                                </div>
                                {% if app.user %}
                                    <div class="col-md-12">
                                        {% if page in app.user.getPageFollowedEntity %}
                                            <a href=""><span class="icon-large icon icon-user"></span> {% trans %}
                                                page.invite_friend {% endtrans %}</a>
                                        {% else %}
                                            <a href="javascript:util.likePage({{ page.id }})"><span
                                                        class="icon-large icon icon-user"></span> {% trans %}
                                                page.like {% endtrans %}
                                            </a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <h3>{% trans %} wizard.page.followers {% endtrans %}</h3>
                                    <hr>
                                    {% for user in followers %}
                                        <div class="squareUser">
                                            <a href="{{ path('wizardalley_user_wall',{'id': user.id}) }}">
                                                <div class="imgSquare">
                                                    <div class="imgSquareContainer">
                                                        <img src="
                                                {% if user.pathProfile %}
                                                     {{ asset('uploads/profile/' ~ user.id ~ '/' ~ user.pathProfile) }}
                                                {% else %}
                                                    {{ asset('uploads/profile/default.png') }}
                                                {% endif %}"/>
                                                        <p class="imgTitre">{{ user.username }}</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <h3>{% trans %} wizard.page.editor {% endtrans %}</h3>
                                    <hr>
                                    {% for user in editors %}
                                        <div class="squareUser">
                                            <a href="{{ path('wizardalley_user_wall',{'id': user.id}) }}">
                                                <div class="imgSquare">
                                                    <div class="imgSquareContainer">
                                                        <img src="
                                                {% if user.pathProfile %}
                                                     {{ asset('uploads/profile/' ~ user.id ~ '/' ~ user.pathProfile) }}
                                                {% else %}
                                                    {{ asset('uploads/profile/default.png') }}
                                                {% endif %}"/>
                                                        <p class="imgTitre">{{ user.username }}</p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-md-9">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <p>{{ page.description | raw }}</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-xs-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <h3>
                        {% trans %}wizard.page.publications{% endtrans %}
                    </h3>
                    <div id="my_publication">
                    </div>
                </div>
                <div class="panel-footer text-center">
                    <span class="glyphicon glyphicon-chevron-down clickable load-more-publication" aria-hidden="true"></span>
                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script>
        _$page = 1;
        loadMore();
        $('.load-more-publication').on('click', function () {
            loadMore();
        });

        function loadMore() {
            var _handler = function ($data) {
                $('#my_publication').append($data['extra']['html']);
            };
            $result = util.loadMore(Routing.generate('page_publication_get', {
                'id': {{ page.id }} ,
                'page': _$page
            }), 'GET', _handler);
            _$page = _$page + 1;
        }
        ;
    </script>
{% endblock %}
