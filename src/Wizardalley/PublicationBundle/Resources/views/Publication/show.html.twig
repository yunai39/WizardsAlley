{% extends '::base.html.twig' %}

{% block body -%}
    <style>
        .comment_image{
            width:7%;
            margin:1%;
            padding:0;
            display: inline-block;
        }
        .comment_image img{
            width:100%;
        }
        
        .comment_content{
            
            width:87%;
            margin:1%;
            padding:0;
            display: inline-block;
        }
        .comment_content .time{
            font-size: 0.7em;
        }
        
    </style>
    <h1>{{ entity.title }}</h1>
    <h2><a href="{{path('page_show',{'id_page': entity.page.id})}}" >{{entity.page.name}}</a></h2>
    <p>Par <a href="{{path('wizardalley_user_wall', {'id': entity.user.id })}}">{{entity.user.username }}</a>, le {{ entity.datePublication|date('Y-m-d') }}
    <p>{{ entity.content | raw}}</p>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        
        <ol class="carousel-indicators">
            {% set i = 0 %}
            {% for image in entity.getImages() %}
                
                <li data-target="#myCarousel" data-slide-to="{{i}}" {% if i == 0 %} class="active"{% endif %} ></li>

                {% set i = i + 1 %}
            {% endfor %}
        </ol>
        
        <div class="carousel-inner " role="listbox">
            {% set i = 0 %}
            {% for image in entity.getImages() %}
                
                <div class="item {% if i == 0 %} active{% endif %}">
                    <img src="{{asset(image.getWebPath())}}"   alt="{{i}}">
                    <div class="carousel-caption">
                        {{image.description}}
                    </div>
                </div>
                {% set i = i + 1 %}
            {% endfor %}
        </div>

        <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
    </div>
    <h3>Commentaires</h3>
    <div class="comment_block">
        <div id="comment_content">

        </div>
        <button class="wizard-load-comments">Plus de commentaires</button>
        
    {% if app.user %}
        <div>
            {{form(comment_form)}}
        </div>
    {% endif %}
    </div>
{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script>
    var _$page = 1;

    function loadComment(data){
        console.log(data);
        $.each(data['extra']['data'],function(index, value){
            addComment(value);
        });
    }

    function loadMore(){
        _handler = function(data){
            console.log(data);
            $.each(data['extra']['data'],function(index, value){
                addComment(value);
            });
        };
        $result = util.loadMore(
                Routing.generate('comment_get', {'id': {{entity_id}}, 'page': _$page}),
                'GET',
                _handler
        );
        _$page = _$page+1;
    };

    loadMore();

    $('.wizard-load-comments').on('click', function(){
        loadMore();
    });

    
    function addComment(comment){
        $li = $('<div>\n\
            <div class="comment_image"><img src="{{asset('uploads/profile/')}}'+comment.id+'/'+comment.pathProfile+'"/></div>\n\
            <div class="comment_content">\n\
                <p class="message">'+comment[0].content+'</p>\n\
                <p class="time">Par  '+comment.username+', le '+comment[0].dateComment.date.substr(0,19)+'</p>\n\
            </div>\n\
        </div>');
        $div=$('#comment_content');
        $div.append($li);
    }
    
    $('.carousel').carousel({
        interval: 3000
    });
    </script>
{% endblock %}
